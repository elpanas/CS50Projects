{% extends "auctions/layout.html" %}

{% block body %}
{% if message %}
    <div class="alert alert-{{ message_type }}" role="alert">
        {{ message }}
    </div>
{% endif %}
{% if listing %}
    <div class="container">
        <div class="row">
            <div class="col"><h3>Listing: {{ listing.title }}</h3></div>
            <div class="col"><h3>€ {{ listing.best_bid }}</h3></div>
            <div class="w-100"></div>
            <div class="col">
                <div class="text-left">
                    {% if listing.image_addr %}
                        <img src="{{ listing.image_addr }}" class="img-thumbnail" alt="...">
                    {% else %}
                        No photo
                    {% endif %}
                </div>
            </div>
            <div class="col">
                <form method="POST" action="">
                    {% csrf_token %}
                    <input type="hidden" name="type" value="addbid"/>
                    <span style="font-size: x-small;">{{ tot_bid.bid__count }} bid(s)</span>
                    {% if user.is_authenticated %}
                        {% if user != listing.seller and not listing.closed %}                        
                        <div class="input-group mb-2">                
                            <div class="input-group-prepend">                    
                                <span class="input-group-text">€</span>
                            </div>                
                            <input type="number" name="bid" class="form-control" aria-label="Amount (to the nearest euro)" placeholder="Put here your bid">
                            <div class="input-group-append">
                                <span class="input-group-text">.00</span>
                            </div>                              
                        </div>                                   
                        <div class="input-group-append">
                            <input type="submit" class="btn btn-dark" value="Place Bid"/>
                        </div>  
                        {% endif %}
                    {% endif %} 
                </form> 
                <p>   
                <div class="row">
                    <div class="col">
                        {% if user.is_authenticated %}
                            {% if listing.closed %}  
                                    <div class="alert alert-{{ messagec_type }}" role="alert">
                                         {{ messagec }}
                                    </div> 
                            {% else %}   
                                {% if user != listing.seller %}                                                                      
                                    <form method="POST" action="">
                                        {% csrf_token %}
                                        <input type="hidden" name="type" value="addremtow"/>
                                        <input type="submit" class="btn btn-outline-{{ messagew_type }}" value="{{ messagew }}"/>
                                    </form>                               
                                {% else %}                            
                                    <form method="POST" action="">
                                        {% csrf_token %}
                                        <input type="hidden" name="type" value="close"/>
                                        <input type="submit" class="btn btn-outline-danger" value="Close Auction"/>
                                    </form>
                                {% endif %}
                            {% endif %}
                        {% endif %}                
                    </div>
                </div>
                </p>                              
            </div>
        </div>
        <div class="row">
            <div class="col">
                <p></p>
                <h4>Description:</h4>
                {{ listing.description }}                
            </div>
            <div class="col"></div>            
            <div class="w-100"></div>
            <div class="col">
                <p></p>
                <h6>Details:</h6>
                <ul style="font-size: small;">
                    <li><u>Seller:</u> {{ listing.seller }}</li>
                    <li><u>Category:</u> {{listing.category }}</li>
                </ul>
            </div>        
        </div>
        <div class="row">
            <div class="col">                
                {% if comments %}
                    <p></p>
                    <h4>Comments</h4>
                    {% for comment in comments %}
                    <div class="card">
                        <div class="card-header">
                        {{ comment.title }}
                        </div>
                        <div class="card-body">
                        <blockquote class="blockquote mb-0">
                            <p>{{ comment.content }}</p>
                            <footer class="blockquote-footer"><cite title="Source Title">{{ comment.date }}</cite></footer>
                        </blockquote>
                        </div>
                    </div>
                    <p></p>
                    {% endfor %}
                {% else %}
                    <h4>No comments yet</h4>                    
                {% endif %}
                {% if not listing.closed %}
                <p>                        
                    <button class="btn btn-secondary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                      Add a comment
                    </button>
                </p>
                  <div class="collapse" id="collapseExample">
                    <div class="card card-body">
                        <form method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="type" value="comment"/>
                            <div class="form-group">
                                <label for="titleid"><b>Title</b></label>
                                <input name="title" type="text" class="form-control" id="titleid" placeholder="Title" required>
                            </div>
                            <div class="form-group">
                                <label for="contentid"><b>Content</b></label>
                                <textarea name="content" class="form-control" id="contentid" aria-label="With textarea"></textarea>
                            </div>
                            <input class="btn btn-outline-secondary" type="submit" value="Submit">
                        </form>                
                    </div>
                  </div>
                  {% endif %}
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}